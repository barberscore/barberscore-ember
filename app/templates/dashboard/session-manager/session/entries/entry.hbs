<section id="entry-detail">
  <div class='panel panel-default'>
    <div class='panel-heading fixed-panel-header'>
      {{!-- <ul class='list-inline pull-right'>
        <li>{{#bs-button disabled=isPrevDisabled onClick=(action 'previousItem' model)}}Previous{{/bs-button}}</li>
        <li>{{#bs-button disabled=isNextDisabled onClick=(action 'nextItem' model)}}Next{{/bs-button}}</li>
      </ul> --}}
      <h4>
        {{model.group.name}}&nbsp;({{model.representing}}){{#if model.prelim}}&nbsp;&mdash;&nbsp;{{single-fixed model.prelim}}{{/if}}&nbsp;{{#if model.group.isSenior}}<span class="label label-warning">Seniors</span>{{/if}}&nbsp;{{#if (eq model.group.status 'Active')}}<span class="label label-success">Active</span>{{else}}<span class="label label-danger">Inactive</span>{{/if}}
      </h4>
    </div>
    <div class='panel-body'>
      <section>
        <p>
          Preferences
        </p>
        <p>
          {{entry-preferences model=model}}
        </p>
      </section>
      <hr>
      <section>
        <p>
          Contests Entered: {{model.includedContestantsCount}}
        </p>
        <p>
          {{entry-contestants model=model}}
        </p>
      </section>
      <hr>
      <section>
        <p>
          Group Members: {{model.group.activesCount}} &nbsp;&nbsp;
          {{#bs-button class='btn' size='xs' onClick=(toggle 'membersCollapsed' this)}}
            {{if membersCollapsed 'Show' 'Hide'}}
          {{/bs-button}}
        </p>
        {{#bs-collapse collapsed=membersCollapsed}}
          {{group-members model=model.group}}
        {{/bs-collapse}}
      </section>
      <hr>
      <section>
        <p>
          Repertory Songs: {{model.group.repertoriesCount}} &nbsp;&nbsp;
          {{#bs-button class='btn' size='xs' onClick=(toggle 'repertoriesCollapsed' this)}}
            {{if repertoriesCollapsed 'Show' 'Hide'}}
          {{/bs-button}}
        </p>
        {{#bs-collapse collapsed=repertoriesCollapsed}}
          {{group-repertories model=model.group}}
        {{/bs-collapse}}
      </section>
      <hr>
      <section>
        <div class='row'>
          <div class='col-md-6'>
            <p>
              Additional Notes:
            </p>
            <p>
              {{entry-description model=model}}
            </p>
          </div>
        </div>
      </section>
      <hr>
      <section>
        <div class='table-responsive'>
          <p>
            Activity
          </p>
          <table class='table'>
            <thead>
              <tr>
                <th>Transition</th>
                <th>By</th>
                <th>Timestamp</th>
              </tr>
            </thead>
            <tbody>
              {{#each model.logs as |log|}}
                <tr>
                  {{#if log.isLoading}}
                    <td colspan=2>Loading&nbsp;{{fa-icon 'spinner' spin=true}}</td>
                  {{else}}
                    <td>{{log.transition}}</td>
                    <td>{{log.by}}</td>
                    <td>{{moment-format log.timestamp 'LLL'}}</td>
                  {{/if}}
                </tr>
              {{else}}
                <tr>
                  <td>(No activity logs.)</td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      </section>
    </div>
    <div class='panel-footer fixed-panel-footer'>
      <ul class='list-inline'>
        {{#if model.permissions.write}}
          {{#if (eq model.status 'New')}}
          {{else if (eq model.status 'Built')}}
            {{#if model.session.isInvitational}}
              <li>{{#bs-button type='primary' disabled=model.isError onClick=(action (mut inviteEntryModal) true)}}Invite Entry{{/bs-button}}</li>
            {{else}}
              <li>{{#bs-button type='primary' disabled=model.isError onClick=(action (mut approveEntryModal) true)}}Approve Entry{{/bs-button}}</li>
            {{/if}}
            <li>{{#bs-button type='danger' disabled=model.isError onClick=(action (mut deleteEntryModal) true)}}Delete Entry{{/bs-button}}</li>
          {{else if (eq model.status 'Invited')}}
            <li>{{#bs-button type='primary' disabled=model.isError onClick=(action (mut submitEntryModal) true)}}Submit Entry{{/bs-button}}</li>
            <li>{{#bs-button type='danger' disabled=model.isError onClick=(action (mut withdrawEntryModal) true)}}Withdraw Entry{{/bs-button}}</li>
          {{else if (eq model.status 'Submitted')}}
            <li>{{#bs-button type='primary' disabled=model.isError onClick=(action (mut approveEntryModal) true)}}Approve Entry{{/bs-button}}</li>
            <li>{{#bs-button type='danger' disabled=model.isError onClick=(action (mut withdrawEntryModal) true)}}Withdraw Entry{{/bs-button}}</li>
          {{else if (eq model.status 'Approved')}}
            <li>{{#bs-button type='primary' disabled=model.isError onClick=(action (mut approveEntryModal) true)}}Re-Approve Entry{{/bs-button}}</li>
            <li>{{#bs-button type='danger' disabled=model.isError onClick=(action (mut scratchEntryModal) true)}}Scratch Entry{{/bs-button}}</li>
          {{else if (eq model.status 'Withdrawn')}}
            <li>{{#bs-button type='primary' disabled=model.isError onClick=(action (mut approveEntryModal) true)}}Re-Approve Entry{{/bs-button}}</li>
          {{else if (eq model.status 'Scratched')}}
            <li>{{#bs-button type='primary' disabled=model.isError onClick=(action (mut approveEntryModal) true)}}Re-Approve Entry{{/bs-button}}</li>
          {{/if}}
        {{/if}}
        <li class='pull-right'><h4>Entry Status: <strong>{{model.status}}</strong></h4></li>
      </ul>
    </div>
  </div>
</section>
<section>
  {{#bs-modal
    open=inviteEntryModal
    onHidden=(pipe-action (action (mut inviteEntryModal) false) (action (mut inviteEntryModalError) false))
    as |modal|
  }}
    {{#modal.header}}
      <h4>Invite Entry</h4>
    {{/modal.header}}
    {{#modal.body}}
      <p>
        This will formally invite the group to the contest and allow them to submit an entry.  The group admin will be sent an email with instructions how to proceed.
      </p>
      {{#if inviteEntryModalError}}
      <p class='text-danger'>
        Could not invite group.  Usually this is because the group does not have an official contact.  Regardless, contact support for assistance.
      </p>
      {{/if}}
    {{/modal.body}}
    {{#modal.footer}}
      {{#bs-button onClick=(action modal.close) type="default"}}Cancel{{/bs-button}}
      {{#bs-button type='primary' onClick=(perform inviteEntry)}}
        {{#if inviteEntry.isRunning}}
          Inviting {{fa-icon "spinner" spin=true}}
        {{else}}
          Invite Entry
        {{/if}}
      {{/bs-button}}
    {{/modal.footer}}
  {{/bs-modal}}
</section>
<section>
  {{#bs-modal
    open=deleteEntryModal
    onHidden=(pipe-action (action (mut deleteEntryModal) false) (action (mut deleteEntryModalError) false))
    as |modal|
  }}
    {{#modal.header}}
      <h4>Delete Entry</h4>
    {{/modal.header}}
    {{#modal.body}}
      <p>
        This will delete the entry.  This should generally be used for errors or other cases where the entry should never have existed in the first place, including for invitationals where the entry will not receive an invitation to the contest (either because all slots have already been filled or their qualifying score is too low.)
      </p>
      {{#if deleteEntryModalError}}
      <p class='text-danger'>
        Could not delete entry.  Please contact support.
      </p>
      {{/if}}
    {{/modal.body}}
    {{#modal.footer}}
      {{#bs-button onClick=(action modal.close) type="default"}}Cancel{{/bs-button}}
      {{#bs-button type='danger' onClick=(perform deleteEntry)}}
        {{#if deleteEntry.isRunning}}
          Deleting {{fa-icon "spinner" spin=true}}
        {{else}}
          Delete Entry
        {{/if}}
      {{/bs-button}}
    {{/modal.footer}}
  {{/bs-modal}}
</section>
<section>
  {{#bs-modal
    open=submitEntryModal
    onHidden=(pipe-action (action (mut submitEntryModal) false) (action (mut submitEntryModalError) false))
    as |modal|
  }}
    {{#modal.header}}
      <h4>Submit Entry</h4>
    {{/modal.header}}
    {{#modal.body}}
      <p>
        This submits an entry directly on behalf of a group.  Please make sure the group for whom you are submitting is aware of the requirements (such as copyright clearance, etc.).
      </p>
      {{#if submitEntryModalError}}
      <p class='text-danger'>
        Could not submit entry.  Please contact support.
      </p>
      {{/if}}
    {{/modal.body}}
    {{#modal.footer}}
      {{#bs-button onClick=(action modal.close) type="default"}}Cancel{{/bs-button}}
      {{#bs-button type='primary' onClick=(perform submitEntry)}}
        {{#if submitEntry.isRunning}}
          Submitting {{fa-icon "spinner" spin=true}}
        {{else}}
          Submit Entry
        {{/if}}
      {{/bs-button}}
    {{/modal.footer}}
  {{/bs-modal}}
</section>
<section>
  {{#bs-modal
    open=withdrawEntryModal
    onHidden=(pipe-action (action (mut withdrawEntryModal) false) (action (mut withdrawEntryModalError) false))
    as |modal|
  }}
    {{#modal.header}}
      <h4>Withdraw Entry</h4>
    {{/modal.header}}
    {{#modal.body}}
      <p>
        This will formally withdraw participation in this contest.  Any decision to re-enter the contest must be reviewed and approved by the DRCJ.
      </p>
      {{#if submitEntryModalError}}
      <p class='text-danger'>
        Could not withdraw entry.  Please contact support.
      </p>
      {{/if}}
    {{/modal.body}}
    {{#modal.footer}}
      {{#bs-button onClick=(action modal.close) type="default"}}Cancel{{/bs-button}}
      {{#bs-button type='danger' onClick=(perform withdrawEntry)}}
        {{#if withdrawEntry.isRunning}}
          Declining {{fa-icon "spinner" spin=true}}
        {{else}}
          Withdraw Entry
        {{/if}}
      {{/bs-button}}
    {{/modal.footer}}
  {{/bs-modal}}
</section>
<section>
  {{#bs-modal
    open=approveEntryModal
    onHidden=(pipe-action (action (mut approveEntryModal) false) (action (mut approveEntryModalError) false))
    as |modal|
  }}
    {{#modal.header}}
      <h4>Approve Entry</h4>
    {{/modal.header}}
    {{#modal.body}}
      <p>
        This approves the submission for the group.  They will receive an email notifying them that they are all set for the contest.
      </p>
      {{#if approveEntryModalError}}
      <p class='text-danger'>
        Could not approve entry.  Please contact support.
      </p>
      {{/if}}
    {{/modal.body}}
    {{#modal.footer}}
      {{#bs-button onClick=(action modal.close) type="default"}}Cancel{{/bs-button}}
      {{#bs-button type='primary' onClick=(perform approveEntry)}}
        {{#if approveEntry.isRunning}}
          Approving {{fa-icon "spinner" spin=true}}
        {{else}}
          Approve Entry
        {{/if}}
      {{/bs-button}}
    {{/modal.footer}}
  {{/bs-modal}}
</section>
<section>
  {{#bs-modal
    open=scratchEntryModal
    onHidden=(pipe-action (action (mut scratchEntryModal) false) (action (mut scratchEntryModalError) false))
    as |modal|
  }}
    {{#modal.header}}
      <h4>Scratch Entry</h4>
    {{/modal.header}}
    {{#modal.body}}
      <p>
        This scratches the previously approved contest Entry.  Any decision to re-enter the contest must be reviewed and approved by the DRCJ and is not guaranteed.
      </p>
      {{#if scratchEntryModalError}}
      <p class='text-danger'>
        Could not scratch entry.  Please contact support.
      </p>
      {{/if}}
    {{/modal.body}}
    {{#modal.footer}}
      {{#bs-button onClick=(action modal.close) type="default"}}Cancel{{/bs-button}}
      {{#bs-button type='danger' onClick=(perform scratchEntry)}}
        {{#if scratchEntry.isRunning}}
          Scratching {{fa-icon "spinner" spin=true}}
        {{else}}
          Scratch Entry
        {{/if}}
      {{/bs-button}}
    {{/modal.footer}}
  {{/bs-modal}}
</section>
